{
  "rules": {
    "anonymous_sessions": {
      ".read": true,
      "$sessionId": {
        ".write": true,
        ".validate": "newData.hasChildren(['nickname', 'active', 'created']) && newData.child('nickname').isString() && newData.child('active').isBoolean() && newData.child('created').isNumber()"
      }
    },
    "user_sessions_by_nickname": {
      ".read": true,
      "$nickname": {
        ".write": true,
        ".validate": "newData.isString() || !newData.exists()"
      }
    },
    "messages": {
      ".read": true,
      ".write": true,
      ".indexOn": ["timestamp"],
      "$messageId": {
        ".validate": "newData.hasChildren(['text', 'nickname', 'sessionId', 'timestamp', 'encrypted'])"
      }
    },
    "cleanup_timer": {
      ".read": true,
      ".write": true
    },
    "presence": {
      ".read": true,
      "$sessionId": {
        ".write": true,
        ".validate": "newData.hasChildren(['online', 'lastSeen']) && newData.child('online').isBoolean()"
      }
    },
    "typing": {
      ".read": true,
      "$sessionId": {
        ".write": true
      }
    },
    "dm_conversations": {
      ".read": true,
      "$userId": {
        ".write": true,
        "$username": {
          ".validate": "newData.hasChildren(['username', 'timestamp'])"
        }
      }
    },
    "dm_messages": {
      ".read": true,
      "$roomId": {
        ".write": true,
        ".indexOn": ["timestamp"],
        "$messageId": {
          ".validate": "newData.hasChildren(['from', 'to', 'text', 'timestamp', 'encrypted'])"
        }
      }
    }
  }
}
